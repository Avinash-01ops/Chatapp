<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <title>WebSocket Chat</title>
</head>
<body>
    <!-- Username modal -->
    <div id="usernameModal" class="modal">
        <div class="modal-content">
            <h2>Enter Your Username</h2>
            <input type="text" id="usernameInput" placeholder="Enter username..." />
            <button id="usernameSubmitButton">Submit</button>
        </div>
    </div>

    <div class="chat-container">
      <div class="messages-container" id="messages"></div>
      <div class="message-input-container">
        <input type="text" id="messageInput" placeholder="Enter a message">
        <button id="emojiButton" title="Add Emoji">😊</button>
        <div id="emojiPickerContainer" class="hidden">
          <div id="emojiPicker">
            <span>😀</span> <span>😂</span> <span>❤️</span> <span>👍</span> <span>🎉</span> <span>😊</span>
            <span>🤔</span> <span>🥳</span> <span>🙌</span> <span>😎</span> <span>🙏</span> <span>🤩</span>
          </div>
        </div>
        <button id="sendButton">Send</button>
        <button id="clearChatButton">Clear Chat</button>
      </div>
    </div>
    

    <script>
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const usernameModal = document.getElementById('usernameModal');
        const usernameInput = document.getElementById('usernameInput');
        const usernameSubmitButton = document.getElementById('usernameSubmitButton');
        const clearChatButton = document.getElementById('clearChatButton');
        const emojiButton = document.getElementById('emojiButton');
        const emojiPickerContainer = document.getElementById('emojiPickerContainer');

        const ws = new WebSocket('ws://localhost:3000');

        let username = '';
      
        // Show modal to set username when the page loads
        window.addEventListener('load', () => {
            usernameModal.style.display = 'flex';  // Show modal on page load
        });
      
        // Handle username submission
        usernameSubmitButton.addEventListener('click', () => {
            const input = usernameInput.value.trim();
        
            if (!input) {
                alert('Please enter a username.');
                return;
            }
        
            username = input; // Set the username
            usernameModal.style.display = 'none'; // Hide modal
        });
      
        // Handle receiving messages from the server
        ws.addEventListener('message', (event) => {
            const { username: sender, message } = JSON.parse(event.data); // Parse the received message
            displayMessage(`${sender}: ${message}`);
        });
      
        // Handle sending messages
        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim(); // Trim to avoid sending spaces
        
            if (!username) {
                alert('Please enter a username before sending messages.');
                return;
            }
        
            if (!message) {
                // Display warning in the input box
                messageInput.placeholder = 'Enter a message';
                messageInput.style.border = '2px crimson solid';
                messageInput.style.color = 'red';
        
                // Remove the warning when the user types
                messageInput.addEventListener('input', () => {
                    messageInput.placeholder = 'Type a message...';
                    messageInput.style.border = 'none';
                    messageInput.style.color = 'black';
                });
                return;
            }
        
            // Send message to the server with the username
            const messagePayload = { username, message };
            ws.send(JSON.stringify(messagePayload));
        
            // Display the message in the chat as the sender
            displayMessage(`${username}: ${message}`, true);
            messageInput.value = ''; // Clear the input field
        });
      
        // Display a message
        function displayMessage(content, isSender = false) {
          const isEmojiOnly = /^[\u{1F600}-\u{1F64F}]$/u.test(content.split(': ')[1]); // Checks if message contains only emojis
          const messageContainer = document.createElement('div');
          const messageElement = document.createElement('div');

          if (isEmojiOnly) {
            messageElement.textContent = content.split(': ')[1];
            messageElement.classList.add('enlarged-emoji');
            messageContainer.classList.add('enlarged-emoji-container');
          } else {
            messageElement.textContent = content;
            messageElement.classList.add('message-bubble');
          }

          if (isSender) {
            messageContainer.classList.add('sender-message-container');
          }

          messageContainer.appendChild(messageElement);
          messagesDiv.appendChild(messageContainer);
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Toggle emoji picker
        emojiButton.addEventListener('click', () => {
          emojiPickerContainer.classList.toggle('hidden');
        });

        // Add emoji to input
        emojiPickerContainer.addEventListener('click', (event) => {
          if (event.target.tagName === 'SPAN') {
            const selectedEmoji = event.target.textContent;
            messageInput.value += selectedEmoji;
            emojiPickerContainer.classList.add('hidden');
          }
        });
              
          clearChatButton.addEventListener('click', () => {
          messagesDiv.innerHTML = ''; // Clear all messages
          });
    </script>
</body>
</html>
