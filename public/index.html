<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebSocket Chat</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      background: #111;
      color: #fff;
      font-family: 'Segoe UI', Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .chat-container {
      background: #111;
      box-shadow: none;
      border-radius: 0;
      max-width: 1100px;
      width: 100%;
      height: 80vh;
      display: flex;
      flex-direction: column;
      border: 1px solid #222;
    }
    .messages-container {
      flex-grow: 1;
      overflow-y: auto;
      padding: 20px 10px;
      font-size: 16px;
    }
    .message-container {
      margin-bottom: 18px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .sender-message-container {
      align-items: flex-end;
    }
    .username {
      font-size: 13px;
      color: #505050;
      margin-bottom: 2px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }
    .message-bubble {
      background: #3b3b3b;
      color: #fff;
      padding: 10px 16px;
      border-radius: 8px;
      max-width: 80%;
      word-break: break-word;
      font-size: 16px;
      margin-bottom: 2px;
      box-shadow: none;
      border: none;
    }
    .timestamp {
      font-size: 11px;
      color: #505050;
      margin-top: 2px;
      text-align: right;
      align-self: flex-end;
    }
    .message-input-container {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      background: #111;
      border-top: 1px solid #222;
    }
    #messageInput {
      flex-grow: 1;
      border: 1px solid #333;
      outline: none;
      border-radius: 6px;
      height: 38px;
      font-size: 15px;
      padding: 0 12px;
      background: #222;
      color: #fff;
      box-sizing: border-box;
    }
    #messageInput:focus {
      border-color: #555;
    }
    #sendButton, #clearChatButton {
      background: #222;
      color: #fff;
      border: none;
      border-radius: 6px;
      height: 38px;
      width: 80px;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s;
    }
    #sendButton:hover, #clearChatButton:hover {
      background: #333;
    }
    #emojiButton {
      font-size: 22px;
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      margin-left: 4px;
    }
    #emojiPickerContainer {
      position: absolute;
      bottom: 60px;
      left: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      padding: 8px;
      background: #222;
      border: 1px solid #333;
      border-radius: 5px;
      z-index: 100;
    }
    #emojiPickerContainer.hidden {
      display: none;
    }
    #emojiPickerContainer span {
      cursor: pointer;
      font-size: 22px;
      padding: 3px;
      border-radius: 3px;
      transition: background 0.2s;
    }
    #emojiPickerContainer span:hover {
      background: #333;
    }
    .modal {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(20, 20, 20, 0.85);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #222;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      width: 350px;
      color: #fff;
      box-shadow: none;
    }
    .modal-content input, .modal-content button {
      width: 90%;
      height: 38px;
      margin-top: 18px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #111;
      color: #fff;
      font-size: 15px;
      box-sizing: border-box;
    }
    .modal-content button {
      background: #333;
      cursor: pointer;
      border: none;
    }
    .modal-content button:hover {
      background: #444;
    }
  </style>
</head>
<body>
    <!-- Username modal -->
    <div id="usernameModal" class="modal">
        <div class="modal-content">
            <h2>Enter Your Username</h2>
            <input type="text" id="usernameInput" placeholder="Enter username..." />
            <button id="usernameSubmitButton">Submit</button>
        </div>
    </div>

    <div class="chat-container">
      <div class="messages-container" id="messages"></div>
      <div class="message-input-container">
        <input type="text" id="messageInput" placeholder="Type a message...">
        <button id="emojiButton" title="Add Emoji">üòä</button>
        <div id="emojiPickerContainer" class="hidden">
          <div id="emojiPicker">
            <span>üòÄ</span> <span>üòÇ</span> <span>‚ù§Ô∏è</span> <span>üëç</span> <span>üéâ</span> <span>üòä</span>
            <span>ü§î</span> <span>ü•≥</span> <span>üôå</span> <span>üòé</span> <span>üôè</span> <span>ü§©</span>
          </div>
        </div>
        <button id="sendButton">Send</button>
        <button id="clearChatButton">Clear</button>
      </div>
    </div>
  
    <script>
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const usernameModal = document.getElementById('usernameModal');
        const usernameInput = document.getElementById('usernameInput');
        const usernameSubmitButton = document.getElementById('usernameSubmitButton');
        const clearChatButton = document.getElementById('clearChatButton');
        const emojiButton = document.getElementById('emojiButton');
        const emojiPickerContainer = document.getElementById('emojiPickerContainer');

        const ws = new WebSocket('ws://localhost:3000');

        let username = '';
      
        // Show modal to set username when the page loads
        window.addEventListener('load', () => {
            usernameModal.style.display = 'flex';
        });
      
        // Handle username submission
        usernameSubmitButton.addEventListener('click', () => {
            const input = usernameInput.value.trim();
            if (!input) {
                alert('Please enter a username.');
                return;
            }
            username = input;
            usernameModal.style.display = 'none';
        });
      
        // Handle receiving messages from the server
        ws.addEventListener('message', (event) => {
            const { username: sender, message } = JSON.parse(event.data);
            displayMessage(sender, message, false);
        });
      
        // Handle sending messages
        sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if (!username) {
                alert('Please enter a username before sending messages.');
                return;
            }
            if (!message) {
                messageInput.placeholder = 'Enter a message';
                messageInput.style.border = '2px crimson solid';
                messageInput.style.color = 'red';
                messageInput.addEventListener('input', () => {
                    messageInput.placeholder = 'Type a message...';
                    messageInput.style.border = '1px solid #333';
                    messageInput.style.color = '#fff';
                }, { once: true });
                return;
            }
            ws.send(JSON.stringify({ username, message }));
            displayMessage(username, message, true);
            messageInput.value = '';
        });

        // Display a message with username above, timestamp below
        function displayMessage(sender, message, isSender = false) {
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('message-container');
            if (isSender) messageContainer.classList.add('sender-message-container');

            const usernameElement = document.createElement('div');
            usernameElement.textContent = sender;
            usernameElement.classList.add('username');

            const messageElement = document.createElement('div');
            messageElement.textContent = message;
            messageElement.classList.add('message-bubble');

            const timestampElement = document.createElement('div');
            timestampElement.textContent = formatTimestamp(new Date());
            timestampElement.classList.add('timestamp');

            messageContainer.appendChild(usernameElement);
            messageContainer.appendChild(messageElement);
            messageContainer.appendChild(timestampElement);

            messagesDiv.appendChild(messageContainer);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function formatTimestamp(date) {
            return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }

        emojiButton.addEventListener('click', () => {
          emojiPickerContainer.classList.toggle('hidden');
        });

        emojiPickerContainer.addEventListener('click', (event) => {
          if (event.target.tagName === 'SPAN') {
            messageInput.value += event.target.textContent;
            emojiPickerContainer.classList.add('hidden');
          }
        });

        clearChatButton.addEventListener('click', () => {
          messagesDiv.innerHTML = '';
        });
    </script>
</body>
</html>
